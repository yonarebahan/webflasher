<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>ESP32-C3 Simple Flasher (WORKING)</title>
<script src="https://unpkg.com/esp-web-flash/bundle.js"></script>
<style>
body { background:#111; color:#fff; font-family:Arial; text-align:center; padding:40px; }
.box { background:#222; padding:20px; border-radius:10px; width:420px; margin:auto; }
button { padding:10px 20px; font-size:16px; margin:5px; }
pre { background:#000; padding:10px; height:200px; overflow:auto; text-align:left; }
</style>
</head>
<body>

<div class="box">
<h2>ESP32-C3 Simple Flasher (WORKS)</h2>
<button id="connect">Connect</button>
<button id="flash">Flash Firmware</button>
<pre id="log"></pre>
</div>

<script>
let flasher;

function log(t){
  document.getElementById("log").textContent += t + "\n";
}

document.getElementById("connect").onclick = async () => {
  try {
    const device = await navigator.serial.requestPort();
    flasher = new ESPWebFlash(device);
    await flasher.connect();
    log("Connected to ESP32 Bootloader!");
  } catch(e){
    log("ERR: " + e);
  }
};

document.getElementById("flash").onclick = async () => {
  try {
    log("Loading firmware...");
    const res = await fetch("firmware/merged-firmware.bin");
    const firmware = new Uint8Array(await res.arrayBuffer());

    log("Erasing flash...");
    await flasher.eraseFlash();

    log("Flashing " + firmware.length + " bytes...");
    await flasher.flashData(firmware, 0x0);

    log("Rebooting...");
    await flasher.reboot();

    log("DONE! Firmware flashed.");
  } catch(e){
    log("ERR: " + e);
  }
};
</script>

</body>
</html>
