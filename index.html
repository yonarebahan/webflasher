<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>ESP32-C3 Simple Flasher</title>

<!-- ESP Web Tools official -->
<script type="module" src="https://unpkg.com/esp-web-tools@9.1.1/dist/web/install-button.js"></script>

<style>
body { background:#111; color:#fff; font-family:Arial; padding:40px; text-align:center; }
.card { max-width:480px; margin:auto; padding:24px; background:#222; border-radius:12px; }
pre { background:#000; padding:12px; height:200px; overflow:auto; text-align:left; border-radius:8px; }
button { padding:10px 20px; margin-top:10px; font-size:16px; }
</style>

</head>
<body>
<div class="card">
<h2>ESP32-C3 Simple Flasher</h2>
<p>Klik Connect â†’ Install. otomatis flash <code>firmware.bin</code></p>

<esp-web-install-button id="flashBtn"></esp-web-install-button>

<pre id="log"></pre>
</div>

<script>
(async () => {
  const firmwareUrl = "firmware/firmware.bin";  // auto-load dari folder kamu

  // Build manifest minimal (1 file aja)
  const manifest = {
    "name": "ESP32-C3 Simple",
    "version": "1.0",
    "builds": [
      {
        "chipFamily": "ESP32-C3",
        "parts": [
          { "path": firmwareUrl, "offset": 0 }
        ]
      }
    ]
  };

  const blob = new Blob([JSON.stringify(manifest)], { type: "application/json" });
  const manifestURL = URL.createObjectURL(blob);

  const installer = document.getElementById("flashBtn");
  installer.setAttribute("manifest", manifestURL);

  const log = (msg) => {
    document.getElementById("log").textContent += msg + "\n";
  };

  installer.addEventListener("esp-web-install-start", () => log("[START]"));
  installer.addEventListener("esp-web-install-error", (e) => log("[ERROR] " + e.detail.message));
  installer.addEventListener("esp-web-install-complete", () => log("[DONE] Firmware installed!"));
})();
</script>

</body>
</html>
