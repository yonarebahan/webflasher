<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>ESP32-C3 Simple Web Flasher</title>
<script src="https://unpkg.com/esptool-js/bundle.js"></script>
<style>
body { background:#111; color:#fff; font-family:Arial; text-align:center; padding:40px; }
.box { background:#222; padding:20px; border-radius:10px; width:420px; margin:auto; }
button { padding:10px 20px; font-size:16px; margin:5px; }
pre { background:#000; padding:10px; height:200px; overflow:auto; text-align:left; }
</style>
</head>
<body>

<div class="box">
<h2>ESP32-C3 Simple Web Flasher</h2>
<button id="connectBtn">Connect</button>
<button id="flashBtn">Flash Firmware</button>
<pre id="log"></pre>
</div>

<script>
let device;
let esploader;

function log(t){
  document.getElementById("log").textContent += t + "\n";
}

document.getElementById("connectBtn").onclick = async () => {
  try {
    device = await navigator.serial.requestPort();
    await device.open({ baudRate: 115200 });
    esploader = new esptooljs.EspLoader(device, {baudrate:115200, debug:true});
    await esploader.main();
    log("Connected to bootloader!");
  } catch(e){ log("ERR: " + e); }
};

document.getElementById("flashBtn").onclick = async () => {
  try {
    log("Loading firmware...");
    const file = await fetch("firmware/merged-firmware.bin");
    const buf = new Uint8Array(await file.arrayBuffer());

    log("Erasing flash...");
    await esploader.flash_id();
    await esploader.erase_flash();

    log("Flashing " + buf.length + " bytes...");
    await esploader.program(buf, 0x0);

    log("DONE! Rebooting...");
    await esploader.reset();
    log("Success!");
  } catch(e){ log("ERR: " + e); }
};
</script>

</body>
</html>
